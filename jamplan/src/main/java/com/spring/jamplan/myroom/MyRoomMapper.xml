<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.spring.jamplan.myroom.MyRoomMapper">

	<resultMap type="TeamVO" id="teamResultMap">
		<result property="id" column="id" />
		<result property="role" column="role" />
		<result property="teamName" column="teamName" />
		<result property="teamNo" column="teamNo" />
		<result property="planNo" column="planNo" />
	</resultMap>
	
	<resultMap type="UserVO" id="userResultMap">
		<result property="id" column="id" />
		<result property="email" column="email" />
		<result property="pass" column="pass" />
		<result property="nation" column="nation" />
		<result property="gender" column="gender" />
		<result property="travelType" column="travelType" />
		<result property="hobby" column="hobby" />
		<result property="image" column="image" />
		<result property="age" column="age" />
		<result property="isAdmin" column="isAdmin" />
		<result property="signDate" column="signDate" />
	</resultMap>
	
	<resultMap type="TeamInfoVO" id="teamInfoResultMap">
		<result property="teamNo" column="teamNo" />
		<result property="teamName" column="teamName" />
		<result property="id" column="id" />
		<result property="joinDate" column="joinDate" />
	</resultMap>
	
	<resultMap type="CalendarVO" id="calendarResultMap">
		<result property="planNo" column="planNo" />
		<result property="selectDate" column="selectDate" />
		<result property="dateCount" column="dateCount" />
		<result property="confirmIndicator" column="confirmIndicator" />
		<result property="id" column="id" />
	</resultMap>
	
	<resultMap type="PlanVO" id="planResultMap">
		<result property="planNo" column="planNo" />
		<result property="teamNo" column="teamNo" />
		<result property="goodCount" column="goodCount" />
		<result property="readCount" column="readCount" />
		<result property="isOpen" column="isOpen" />
		<result property="planName" column="planName" />
		<result property="hashTag" column="hashTag" />
		<result property="planDate" column="planDate" />
	</resultMap>
	
	<resultMap type="MessageVO" id="messageResultMap">
		<result property="sender" column="sender" />
		<result property="receiver" column="receiver" />
		<result property="isRead" column="isRead" />
	</resultMap>
	
	<resultMap type="PlanUpdateVO" id="planUpdateResultMap">
		<result property="planNo" column="planNo" />
		<result property="confirmIndicator" column="confirmIndicator" />
		<result property="dateCheck" column="dateCheck" />
	</resultMap>
	
	
	<select id="getTeamList" parameterType="com.spring.jamplan.myroom.TeamVO" resultMap="teamResultMap">
		SELECT * FROM USERTEAM WHERE ID=#{id, jdbcType=VARCHAR} ORDER BY TEAMNAME
	</select>
	
	<select id="getTeamMember" parameterType="com.spring.jamplan.myroom.UserVO" resultMap="teamResultMap">
		SELECT ID FROM USERTEAM WHERE TEAMNO IN (SELECT DISTINCT TEAMNO FROM USERTEAM WHERE ID=#{id, jdbcType=VARCHAR})
	</select>
	
	<select id="getPlanList" parameterType="com.spring.jamplan.myroom.TeamVO" resultMap="planResultMap">
		SELECT * FROM PLAN WHERE TEAMNO IN (SELECT TEAMNO FROM USERTEAM WHERE ID = #{id, jdbcType=VARCHAR })
	</select>
	
	<select id="checkUpdate" parameterType="com.spring.jamplan.myroom.UserVO" resultMap="planUpdateResultMap">
		SELECT * FROM (SELECT * FROM PLANUPDATE WHERE PLANNO IN (SELECT PLANNO FROM USERTEAM WHERE ID=#{id, jdbcType=VARCHAR }) ORDER BY DATECHECK DESC) 
			WHERE ROWNUM <![CDATA[<=]]> 10
	</select>
	
	<select id="getUserInfo" parameterType="com.spring.jamplan.myroom.UserVO" resultMap="userResultMap" >
		SELECT * FROM USERINFO2 WHERE ID={id, jdbcType=VARCHAR }
	</select>
	
	<select id="getMessageList" parameterType="String" resultMap="messageResultMap">
		SELECT * FROM (SELECT * FROM MESSAGE WHERE RECEIVER=#{receiver, jdbcType=VARCHAR }) 
			WHERE ISREAD = 0;
	</select>
	
	<select id="searchTeam" parameterType="com.spring.jamplan.myroom.TeamInfoVO" resultMap="teamInfoResultMap" >
		SELECT * FROM TEAMINFO WHERE TEAMNAME LIKE '%'||#{teamName, jdbcType=VARCHAR}||'%'
		
	</select>
	
	<select id="searchPlan" parameterType="com.spring.jamplan.myroom.PlanVO" resultMap="planResultMap" >
		SELECT * FROM PLAN WHERE PLANNO=#{planNo, jdbcType=INTEGER }
	</select>
	
	<insert id="makeTeam" parameterType="com.spring.jamplan.myroom.TeamVO"  >
		INSERT INTO TEAMINFO(TEAMNO, TEAMNAME, ID, JOINDATE) 
			VALUES(TEAMINFO_SEQ.NEXTVAL, #{teamName, jdbcType=VARCHAR}, #{id, jdbcType=VARCHAR}, SYSDATE)
	</insert>
	
	<insert id="makePlan" parameterType="com.spring.jamplan.myroom.PlanVO"  >
		INSERT INTO PLAN(PLANNO, TEAMNO, PLANNAME, PLANDATE, ISOPEN)
			VALUES(#{PLAN_SEQ.NEXTVAL}, #{teamNo}, #{planName, jdbcType=VARCHAR}, SYSDATE, #{isOpen})
	</insert>
	
	<select id="validationTeamName" parameterType="com.spring.jamplan.myroom.TeamVO" resultMap="teamResultMap" >
		SELECT * FROM TEAMINFO WHERE TEAMNAME=#{teamName, jdbcType=VARCHAR }
	</select>
	
	<delete id="deleteTeam" parameterType="com.spring.jamplan.myroom.TeamVO"  >
		DELETE FROM TEAMINFO WHERE TEAMNAME=#{teamName, jdbcType=VARCHAR}
	</delete>
	
	<delete id="deletePlan" parameterType="com.spring.jamplan.myroom.PlanVO"  >
		DELETE FROM PLAN WHERE PLANNO=#{planNo}
	</delete>
	
</mapper>