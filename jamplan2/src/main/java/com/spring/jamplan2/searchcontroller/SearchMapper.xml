<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- create table plan( image varchar2(100), planDate varchar2(200), planName 
	varchar2(200), goodCount varchar2(400), readCount varchar2(200) ); -->

<mapper
	namespace="com.spring.jamplan2.searchcontroller.SearchMapper">

	<resultMap type="PlanVO" id="planResultMap">
		<result property="image" column="image" />
		<result property="planDate" column="planDate" />
		<result property="planName" column="planName" />
		<result property="goodCount" column="goodCount" />
		<result property="readCount" column="readCount" />
	</resultMap>
	
	<resultMap type="UserVO" id="UserResultMap">
		<result property="id" column="id" />
	</resultMap>
	
	<!-- //라이크-로그인db에서 받아오기
	<resultMap type="LikeVO" id="likeUserResultMap">
		<result property="userId" column="userId" />
	</resultMap> -->
	
	
	<resultMap type="LikeVO" id="LikeResultMap">
		<result property="planNo" column="planNo" />
		<result property="userId" column="userId" />
	</resultMap>



	<select id="getPlanList" resultMap="planResultMap">
		SELECT * FROM plan order by planDate desc
	</select>

	<insert id="fileUpload"
		parameterType="com.spring.jamplan2.searchcontroller.PlanVO">
		insert into plan(image) values (#{image})
	</insert>

	<select id="planSearch"
		parameterType="com.spring.jamplan2.searchcontroller.PlanVO"
		resultMap="planResultMap">

		SELECT * FROM plan
		
		<if test='planName != null '>
			where planName like '%'||#{planName, jdbcType=VARCHAR}||'%' order by planName
		</if>
		<if test='planDate != null '>
			where planDate like '%'||#{planDate, jdbcType=VARCHAR}||'%' order by planDate desc
		</if>

	</select>

	<select id="clickSearch"
		parameterType="com.spring.jamplan2.searchcontroller.PlanVO"
		resultMap="planResultMap">

		SELECT * FROM plan

		<if test='planDate != null and planDate.equals("a")'>
			order by planDate desc
		</if>
		<if test='readCount != null and readCount.equals(1)'>
			order by readCount
		</if>
		<if test='goodCount != null and goodCount.equals(2)'>
			order by goodCount
		</if>
		<if test='planName != null and planName.equals("b")'>
			order by planName
		</if>


	</select>
	
	<!--조회수도전
	<update id="moveSchedule" parameterType="com.spring.jamplan2.searchcontroller.PlanVO" >
		UPDATE PLAN SET READCOUNT = READCOUNT + 1 WHERE PLANNO = #{PLANNO, jdbcType=NUMBER}
	</update>  -->
	<!-- 조회수 <update id="?" parameterType="com.spring.jamplan2.searchcontroller.PlanVO" 
		> update plan set readCount = (select readCount from plan where planName 
		= #{planName, jdbcType=VARCHAR}) + 1 where planNo = #{planNo, jdbcType=NUMBER} 
		</update> -->
	
	<select id="getUserId" parameterType="com.spring.jamplan2.searchcontroller.UserVO" resultMap="UserResultMap">
		select * from userVO where id = #{id, javaType=String}
	</select>
	
	<!-- //라이크-로그인db에서 받아오기
	<select id="likeUserId" parameterType="com.spring.jamplan2.searchcontroller.LikeVO" resultMap="likeUserResultMap">
		select * from likeTo where userId = #{userId, jdbcType=VARCHAR}
	</select> -->
	
	<!-- 좋아요도전
	<update id="heartCheck" parameterType="com.spring.jamplan2.searchcontroller.LikeVO" resultMap="LikeResultMap">
		UPDATE LIKETEST SET likeNo = #{likeNo, jdbcType=NUMBER} + 1
	</update> -->
	
	<select id="getLikeData" parameterType="com.spring.jamplan2.searchcontroller.LikeVO" resultMap="LikeResultMap">
		SELECT * FROM LIKETO where userId = #{userId, jdbcType=VARCHAR}
	</select>
	
	<insert id="insertLikeData" parameterType="com.spring.jamplan2.searchcontroller.LikeVO">
		insert into LIKETO VALUES(#{planNo, jdbcType = INTEGER}, #{userId, jdbcType=VARCHAR})
	</insert>
	
	<update id="updateLikeData" parameterType="com.spring.jamplan2.searchcontroller.LikeVO">
		UPDATE LIKETO SET planNo = #{planNo, jdbcType = INTEGER} where userId = #{userId, jdbcType=VARCHAR}
	</update>




	







</mapper>